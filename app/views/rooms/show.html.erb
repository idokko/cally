<div class = "room-show-wrapper">
    <div class = "container">
        <div class = "row">
            <div class = "col-xs-offset-1 col-xs-10 col-md-offset-3 col-md-6 room-show-container">
                <h1>メッセージ</h1>
                <h4>参加者</h4>
                <% @entries.each do |e| %>
                <% message_count = Notification.where(action: 'dm', visited_id: current_user, visitor_id: e.user.id, checked: false).count %>
                    <h5>
                        <string>
                            <a href = "/users/<%= e.user.id %>">
                                <%= e.user.name %>
                            </a>
                        </string>
                    </h5>
                <% end %>
                
                <hr>
                <% if @messages.present? %>
                    <% @messages.each do |m| %>
                        <% if m.user.name == current_user.name %>
                            <p class = "text-right">
                                
                                    <% if m.content.present? %>
                                    <span class = "message-right">
                                        <%= safe_join(m.content.split("\n"),tag(:br)) %>
                                    </span>
                                    <% end %>
                                    <% if m.images.attached? %>
                                        <% m.images.each do |image| %>
                                        <p class = "text-right">
                                            <%= link_to image, "data-lightbox": image do %>
                                                <%= image_tag image, class: "message-image-resize-right" %>
                                            <% end %>
                                        </p>
                                        <% end %>
                                    <% end %>
                            </p>
                            <p class = "text-right">
                                    <%= I18n.l(m.created_at, format: :short) %>
                            </p>
                        <% else %>
                            <p>
                                <% if m.content.present? %>
                                <span class = "message-left">
                                    <%= safe_join(m.content.split("\n"),tag(:br)) %>
                                </span>
                                <% end %>
                                <p>
                                    <% if m.images.attached? %>
                                        <% m.images.each do |image| %>
                                        <p>
                                            <%= link_to image, "data-lightbox": image do %>
                                                <%= image_tag image, class: "message-image-resize-left" %>
                                            <% end %>
                                        </p>
                                        <% end %>
                                    <% end %>
                                </p>
                            </p>
                            <p>
                                by
                                <strong>
                                    <a href = "/users/<%= m.user.id %>">
                                        <%= m.user.name %>
                                    </a>
                                </strong>
                                <br>
                                    <%= I18n.l(m.created_at, format: :short) %>
                            </p>
                        <% end %>
                    <% end %>
                <% else %>
                    <h3 class = "text-center">メッセージはありません</h3>
                <% end %>
                
                <%= form_with model: @message, local: true do |f| %>
                    <%= f.text_area :content, class: "form-control", :placeholder => "メッセージを入力してください"%>
                    <%= f.file_field :images, multiple: true, class: "image-select" %>
                    <%= f.hidden_field :room_id, :value => @room.id %>
                    <br>
                    <%= f.submit "送信する", class: "btn btn-info message-submit-button" %>
                <% end %>
            </div>
        </div>
    </div>
</div>

<script>
    window.addEventListener('DOMContentLoaded', function(){
        var element = document.documentElement || document.body;
           element.scrollIntoView(false);
    });
</script>